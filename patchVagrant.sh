#! /bin/bash
VAGRANT_FILE_PATH=/opt/vagrant/embedded/gems/gems/vagrant-1.2.2/plugins/providers/virtualbox/action/network.rb

if [ -f $VAGRANT_FILE_PATH ];then
#backup
echo "backing up the file...";
sudo mv $VAGRANT_FILE_PATH $VAGRANT_FILE_PATH.old;
#patch based on https://github.com/jheise/vagrant/commit/7a89ab7fadfd6dcd46d3cdb7d960912d3f2c126f
sudo sh -c "base64 -d << __END_PATCH > ${VAGRANT_FILE_PATH}
cmVxdWlyZSAic2V0IgoKcmVxdWlyZSAibG9nNHIiCgpyZXF1aXJlICJ2YWdyYW50L3V0aWwvbmV0
d29ya19pcCIKcmVxdWlyZSAidmFncmFudC91dGlsL3Njb3BlZF9oYXNoX292ZXJyaWRlIgoKbW9k
dWxlIFZhZ3JhbnRQbHVnaW5zCiAgbW9kdWxlIFByb3ZpZGVyVmlydHVhbEJveAogICAgbW9kdWxl
IEFjdGlvbgogICAgICAjIFRoaXMgbWlkZGxld2FyZSBjbGFzcyBzZXRzIHVwIGFsbCBuZXR3b3Jr
aW5nIGZvciB0aGUgVmlydHVhbEJveAogICAgICAjIGluc3RhbmNlLiBUaGlzIGluY2x1ZGVzIGhv
c3Qgb25seSBuZXR3b3JrcywgYnJpZGdlZCBuZXR3b3JraW5nLAogICAgICAjIGZvcndhcmRlZCBw
b3J0cywgZXRjLgogICAgICAjCiAgICAgICMgVGhpcyBoYW5kbGVzIGFsbCB0aGUgYGNvbmZpZy52
bS5uZXR3b3JrYCBjb25maWd1cmF0aW9ucy4KICAgICAgY2xhc3MgTmV0d29yawogICAgICAgIGlu
Y2x1ZGUgVmFncmFudDo6VXRpbDo6TmV0d29ya0lQCiAgICAgICAgaW5jbHVkZSBWYWdyYW50OjpV
dGlsOjpTY29wZWRIYXNoT3ZlcnJpZGUKCiAgICAgICAgZGVmIGluaXRpYWxpemUoYXBwLCBlbnYp
CiAgICAgICAgICBAbG9nZ2VyID0gTG9nNHI6OkxvZ2dlci5uZXcoInZhZ3JhbnQ6OnBsdWdpbnM6
OnZpcnR1YWxib3g6Om5ldHdvcmsiKQogICAgICAgICAgQGFwcCAgICA9IGFwcAogICAgICAgIGVu
ZAoKICAgICAgICBkZWYgY2FsbChlbnYpCiAgICAgICAgICAjIFRPRE86IFZhbGlkYXRlIG5ldHdv
cmsgY29uZmlndXJhdGlvbiBwcmlvciB0byBhbnl0aGluZyBiZWxvdwogICAgICAgICAgQGVudiA9
IGVudgoKICAgICAgICAgICMgR2V0IHRoZSBsaXN0IG9mIG5ldHdvcmsgYWRhcHRlcnMgZnJvbSB0
aGUgY29uZmlndXJhdGlvbgogICAgICAgICAgbmV0d29ya19hZGFwdGVyc19jb25maWcgPSBlbnZb
Om1hY2hpbmVdLnByb3ZpZGVyX2NvbmZpZy5uZXR3b3JrX2FkYXB0ZXJzLmR1cAoKICAgICAgICAg
ICMgQXNzaWduIHRoZSBhZGFwdGVyIHNsb3QgZm9yIGVhY2ggaGlnaC1sZXZlbCBuZXR3b3JrCiAg
ICAgICAgICBhdmFpbGFibGVfc2xvdHMgPSBTZXQubmV3KDEuLjgpCiAgICAgICAgICBuZXR3b3Jr
X2FkYXB0ZXJzX2NvbmZpZy5lYWNoIGRvIHxzbG90LCBfZGF0YXwKICAgICAgICAgICAgYXZhaWxh
YmxlX3Nsb3RzLmRlbGV0ZShzbG90KQogICAgICAgICAgZW5kCgogICAgICAgICAgQGxvZ2dlci5k
ZWJ1ZygiQXZhaWxhYmxlIHNsb3RzIGZvciBoaWdoLWxldmVsIGFkYXB0ZXJzOiAje2F2YWlsYWJs
ZV9zbG90cy5pbnNwZWN0fSIpCiAgICAgICAgICBAbG9nZ2VyLmluZm8oIkRldGVybWluaW5nIG5l
dHdvcmsgYWRhcHRlcnMgcmVxdWlyZWQgZm9yIGhpZ2gtbGV2ZWwgY29uZmlndXJhdGlvbi4uLiIp
CiAgICAgICAgICBhdmFpbGFibGVfc2xvdHMgPSBhdmFpbGFibGVfc2xvdHMudG9fYS5zb3J0CiAg
ICAgICAgICBlbnZbOm1hY2hpbmVdLmNvbmZpZy52bS5uZXR3b3Jrcy5lYWNoIGRvIHx0eXBlLCBv
cHRpb25zfAogICAgICAgICAgICAjIFdlIG9ubHkgaGFuZGxlIHByaXZhdGUgYW5kIHB1YmxpYyBu
ZXR3b3JrcwogICAgICAgICAgICBuZXh0IGlmIHR5cGUgIT0gOnByaXZhdGVfbmV0d29yayAmJiB0
eXBlICE9IDpwdWJsaWNfbmV0d29yawoKICAgICAgICAgICAgb3B0aW9ucyA9IHNjb3BlZF9oYXNo
X292ZXJyaWRlKG9wdGlvbnMsIDp2aXJ0dWFsYm94KQoKICAgICAgICAgICAgIyBGaWd1cmUgb3V0
IHRoZSBzbG90IHRoYXQgdGhpcyBhZGFwdGVyIHdpbGwgZ28gaW50bwogICAgICAgICAgICBzbG90
ID0gb3B0aW9uc1s6YWRhcHRlcl0KICAgICAgICAgICAgaWYgIXNsb3QKICAgICAgICAgICAgICBp
ZiBhdmFpbGFibGVfc2xvdHMuZW1wdHk/CiAgICAgICAgICAgICAgICByYWlzZSBWYWdyYW50OjpF
cnJvcnM6OlZpcnR1YWxCb3hOb1Jvb21Gb3JIaWdoTGV2ZWxOZXR3b3JrCiAgICAgICAgICAgICAg
ZW5kCgogICAgICAgICAgICAgIHNsb3QgPSBhdmFpbGFibGVfc2xvdHMuc2hpZnQKICAgICAgICAg
ICAgZW5kCgogICAgICAgICAgICAjIENvbmZpZ3VyZSBpdAogICAgICAgICAgICBkYXRhID0gbmls
CiAgICAgICAgICAgIGlmIHR5cGUgPT0gOnByaXZhdGVfbmV0d29yawogICAgICAgICAgICAgICMg
cHJpdmF0ZV9uZXR3b3JrID0gaG9zdG9ubHkKICAgICAgICAgICAgICBkYXRhICAgICAgICA9IFs6
aG9zdG9ubHksIG9wdGlvbnNdCiAgICAgICAgICAgIGVsc2lmIHR5cGUgPT0gOnB1YmxpY19uZXR3
b3JrCiAgICAgICAgICAgICAgIyBwdWJsaWNfbmV0d29yayA9IGJyaWRnZWQKICAgICAgICAgICAg
ICBkYXRhICAgICAgICA9IFs6YnJpZGdlZCwgb3B0aW9uc10KICAgICAgICAgICAgZW5kCgogICAg
ICAgICAgICAjIFN0b3JlIGl0IQogICAgICAgICAgICBAbG9nZ2VyLmluZm8oIiAtLSBTbG90ICN7
c2xvdH06ICN7ZGF0YVswXX0iKQogICAgICAgICAgICBuZXR3b3JrX2FkYXB0ZXJzX2NvbmZpZ1tz
bG90XSA9IGRhdGEKICAgICAgICAgIGVuZAoKICAgICAgICAgIEBsb2dnZXIuaW5mbygiRGV0ZXJt
aW5pbmcgYWRhcHRlcnMgYW5kIGNvbXBpbGluZyBuZXR3b3JrIGNvbmZpZ3VyYXRpb24uLi4iKQog
ICAgICAgICAgYWRhcHRlcnMgPSBbXQogICAgICAgICAgbmV0d29ya3MgPSBbXQogICAgICAgICAg
bmV0d29ya19hZGFwdGVyc19jb25maWcuZWFjaCBkbyB8c2xvdCwgZGF0YXwKICAgICAgICAgICAg
dHlwZSAgICA9IGRhdGFbMF0KICAgICAgICAgICAgb3B0aW9ucyA9IGRhdGFbMV0KCiAgICAgICAg
ICAgIEBsb2dnZXIuaW5mbygiTmV0d29yayBzbG90ICN7c2xvdH0uIFR5cGU6ICN7dHlwZX0uIikK
CiAgICAgICAgICAgICMgR2V0IHRoZSBub3JtYWxpemVkIGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMg
dHlwZQogICAgICAgICAgICBjb25maWcgPSBzZW5kKCIje3R5cGV9X2NvbmZpZyIsIG9wdGlvbnMp
CiAgICAgICAgICAgIGNvbmZpZ1s6YWRhcHRlcl0gPSBzbG90CiAgICAgICAgICAgIEBsb2dnZXIu
ZGVidWcoIk5vcm1hbGl6ZWQgY29uZmlndXJhdGlvbjogI3tjb25maWcuaW5zcGVjdH0iKQoKICAg
ICAgICAgICAgIyBHZXQgdGhlIFZpcnR1YWxCb3ggYWRhcHRlciBjb25maWd1cmF0aW9uCiAgICAg
ICAgICAgIGFkYXB0ZXIgPSBzZW5kKCIje3R5cGV9X2FkYXB0ZXIiLCBjb25maWcpCiAgICAgICAg
ICAgIGFkYXB0ZXJzIDw8IGFkYXB0ZXIKICAgICAgICAgICAgQGxvZ2dlci5kZWJ1ZygiQWRhcHRl
ciBjb25maWd1cmF0aW9uOiAje2FkYXB0ZXIuaW5zcGVjdH0iKQoKICAgICAgICAgICAgIyBHZXQg
dGhlIG5ldHdvcmsgY29uZmlndXJhdGlvbgogICAgICAgICAgICBuZXR3b3JrID0gc2VuZCgiI3t0
eXBlfV9uZXR3b3JrX2NvbmZpZyIsIGNvbmZpZykKICAgICAgICAgICAgbmV0d29ya1s6YXV0b19j
b25maWddID0gY29uZmlnWzphdXRvX2NvbmZpZ10KICAgICAgICAgICAgbmV0d29ya3MgPDwgbmV0
d29yawogICAgICAgICAgZW5kCgogICAgICAgICAgaWYgIWFkYXB0ZXJzLmVtcHR5PwogICAgICAg
ICAgICAjIEVuYWJsZSB0aGUgYWRhcHRlcnMKICAgICAgICAgICAgQGxvZ2dlci5pbmZvKCJFbmFi
bGluZyBhZGFwdGVycy4uLiIpCiAgICAgICAgICAgIGVudls6dWldLmluZm8gSTE4bi50KCJ2YWdy
YW50LmFjdGlvbnMudm0ubmV0d29yay5wcmVwYXJpbmciKQogICAgICAgICAgICBlbnZbOm1hY2hp
bmVdLnByb3ZpZGVyLmRyaXZlci5lbmFibGVfYWRhcHRlcnMoYWRhcHRlcnMpCiAgICAgICAgICBl
bmQKCiAgICAgICAgICAjIENvbnRpbnVlIHRoZSBtaWRkbGV3YXJlIGNoYWluLgogICAgICAgICAg
QGFwcC5jYWxsKGVudikKCiAgICAgICAgICAjIElmIHdlIGhhdmUgbmV0d29ya3MgdG8gY29uZmln
dXJlLCB0aGVuIHdlIGNvbmZpZ3VyZSBpdCBub3csIHNpbmNlCiAgICAgICAgICAjIHRoYXQgcmVx
dWlyZXMgdGhlIG1hY2hpbmUgdG8gYmUgdXAgYW5kIHJ1bm5pbmcuCiAgICAgICAgICBpZiAhYWRh
cHRlcnMuZW1wdHk/ICYmICFuZXR3b3Jrcy5lbXB0eT8KICAgICAgICAgICAgYXNzaWduX2ludGVy
ZmFjZV9udW1iZXJzKG5ldHdvcmtzLCBhZGFwdGVycykKCiAgICAgICAgICAgICMgT25seSBjb25m
aWd1cmUgdGhlIG5ldHdvcmtzIHRoZSB1c2VyIHJlcXVlc3RlZCB1cyB0byBjb25maWd1cmUKICAg
ICAgICAgICAgbmV0d29ya3NfdG9fY29uZmlndXJlID0gbmV0d29ya3Muc2VsZWN0IHsgfG58IG5b
OmF1dG9fY29uZmlnXSB9CiAgICAgICAgICAgIGVudls6dWldLmluZm8gSTE4bi50KCJ2YWdyYW50
LmFjdGlvbnMudm0ubmV0d29yay5jb25maWd1cmluZyIpCiAgICAgICAgICAgIGVudls6bWFjaGlu
ZV0uZ3Vlc3QuY2FwYWJpbGl0eSg6Y29uZmlndXJlX25ldHdvcmtzLCBuZXR3b3Jrc190b19jb25m
aWd1cmUpCiAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZGVmIGJyaWRnZWRfY29u
ZmlnKG9wdGlvbnMpCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICA6YXV0b19jb25maWcg
ICAgICAgICAgICAgICAgICAgICA9PiB0cnVlLAogICAgICAgICAgICA6YnJpZGdlICAgICAgICAg
ICAgICAgICAgICAgICAgICA9PiBuaWwsCiAgICAgICAgICAgIDptYWMgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgID0+IG5pbCwKICAgICAgICAgICAgOm5pY190eXBlICAgICAgICAgICAgICAg
ICAgICAgICAgPT4gbmlsLAogICAgICAgICAgICA6dXNlX2RoY3BfYXNzaWduZWRfZGVmYXVsdF9y
b3V0ZSA9PiBmYWxzZQogICAgICAgICAgfS5tZXJnZShvcHRpb25zIHx8IHt9KQogICAgICAgIGVu
ZAoKICAgICAgICBkZWYgYnJpZGdlZF9hZGFwdGVyKGNvbmZpZykKICAgICAgICAgICMgRmluZCB0
aGUgYnJpZGdlZCBpbnRlcmZhY2VzIHRoYXQgYXJlIGF2YWlsYWJsZQogICAgICAgICAgYnJpZGdl
ZGlmcyA9IEBlbnZbOm1hY2hpbmVdLnByb3ZpZGVyLmRyaXZlci5yZWFkX2JyaWRnZWRfaW50ZXJm
YWNlcwogICAgICAgICAgYnJpZGdlZGlmcy5kZWxldGVfaWYgeyB8aW50ZXJmYWNlfCBpbnRlcmZh
Y2VbOnN0YXR1c10gPT0gIkRvd24iIH0KCiAgICAgICAgICAjIFRoZSBuYW1lIG9mIHRoZSBjaG9z
ZW4gYnJpZGdlIGludGVyZmFjZSB3aWxsIGJlIGFzc2lnbmVkIHRvIHRoaXMKICAgICAgICAgICMg
dmFyaWFibGUuCiAgICAgICAgICBjaG9zZW5fYnJpZGdlID0gbmlsCgogICAgICAgICAgaWYgY29u
ZmlnWzpicmlkZ2VdCiAgICAgICAgICAgIEBsb2dnZXIuZGVidWcoIkJyaWRnZSB3YXMgZGlyZWN0
bHkgc3BlY2lmaWVkIGluIGNvbmZpZywgc2VhcmNoaW5nIGZvcjogI3tjb25maWdbOmJyaWRnZV19
IikKCiAgICAgICAgICAgICMgU2VhcmNoIGZvciBhIG1hdGNoaW5nIGJyaWRnZWQgaW50ZXJmYWNl
CiAgICAgICAgICAgIGJyaWRnZWRpZnMuZWFjaCBkbyB8aW50ZXJmYWNlfAogICAgICAgICAgICAg
IGlmIGludGVyZmFjZVs6bmFtZV0uZG93bmNhc2UgPT0gY29uZmlnWzpicmlkZ2VdLmRvd25jYXNl
CiAgICAgICAgICAgICAgICBAbG9nZ2VyLmRlYnVnKCJTcGVjaWZpYyBicmlkZ2UgZm91bmQgYXMg
Y29uZmlndXJlZCBpbiB0aGUgVmFncmFudGZpbGUuIFVzaW5nIGl0LiIpCiAgICAgICAgICAgICAg
ICBjaG9zZW5fYnJpZGdlID0gaW50ZXJmYWNlWzpuYW1lXQogICAgICAgICAgICAgICAgYnJlYWsK
ICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAjIElmIG9uZSB3
YXNuJ3QgZm91bmQsIHRoZW4gd2Ugbm90aWZ5IHRoZSB1c2VyIGhlcmUuCiAgICAgICAgICAgIGlm
ICFjaG9zZW5fYnJpZGdlCiAgICAgICAgICAgICAgQGVudls6dWldLmluZm8gSTE4bi50KCJ2YWdy
YW50LmFjdGlvbnMudm0uYnJpZGdlZF9uZXR3b3JraW5nLnNwZWNpZmljX25vdF9mb3VuZCIsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpicmlkZ2UgPT4gY29uZmlnWzpicmlk
Z2VdKQogICAgICAgICAgICBlbmQKICAgICAgICAgIGVuZAoKICAgICAgICAgICMgSWYgd2Ugc3Rp
bGwgZG9uJ3QgaGF2ZSBhIGJyaWRnZSBjaG9zZW4gKHRoaXMgbWVhbnMgdGhhdCBvbmUgd2Fzbid0
CiAgICAgICAgICAjIHNwZWNpZmllZCBpbiB0aGUgVmFncmFudGZpbGUsIG9yIHRoZSBicmlkZ2Ug
c3BlY2lmaWVkIGluIHRoZSBWYWdyYW50ZmlsZQogICAgICAgICAgIyB3YXNuJ3QgZm91bmQpLCB0
aGVuIHdlIGZhbGwgYmFjayB0byB0aGUgbm9ybWFsIG1lYW5zIG9mIHNlYXJjaGlnbiBmb3IgYQog
ICAgICAgICAgIyBicmlkZ2VkIG5ldHdvcmsuCiAgICAgICAgICBpZiAhY2hvc2VuX2JyaWRnZQog
ICAgICAgICAgICBpZiBicmlkZ2VkaWZzLmxlbmd0aCA9PSAxCiAgICAgICAgICAgICAgIyBPbmUg
YnJpZGdhYmxlIGludGVyZmFjZT8gSnVzdCB1c2UgaXQuCiAgICAgICAgICAgICAgY2hvc2VuX2Jy
aWRnZSA9IGJyaWRnZWRpZnNbMF1bOm5hbWVdCiAgICAgICAgICAgICAgQGxvZ2dlci5kZWJ1Zygi
T25seSBvbmUgYnJpZGdlZCBpbnRlcmZhY2UgYXZhaWxhYmxlLiBVc2luZyBpdCBieSBkZWZhdWx0
LiIpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAjIE1vcmUgdGhhbiBvbmUgYnJpZGdh
YmxlIGludGVyZmFjZSByZXF1aXJlcyBhIHVzZXIgZGVjaXNpb24sIHNvCiAgICAgICAgICAgICAg
IyBzaG93IG9wdGlvbnMgdG8gY2hvb3NlIGZyb20uCiAgICAgICAgICAgICAgQGVudls6dWldLmlu
Zm8gSTE4bi50KCJ2YWdyYW50LmFjdGlvbnMudm0uYnJpZGdlZF9uZXR3b3JraW5nLmF2YWlsYWJs
ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpwcmVmaXggPT4gZmFsc2Up
CiAgICAgICAgICAgICAgYnJpZGdlZGlmcy5lYWNoX2luZGV4IGRvIHxpbmRleHwKICAgICAgICAg
ICAgICAgIGludGVyZmFjZSA9IGJyaWRnZWRpZnNbaW5kZXhdCiAgICAgICAgICAgICAgICBAZW52
Wzp1aV0uaW5mbygiI3tpbmRleCArIDF9KSAje2ludGVyZmFjZVs6bmFtZV19IiwgOnByZWZpeCA9
PiBmYWxzZSkKICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgIyBUaGUgcmFuZ2Ugb2Yg
dmFsaWQgY2hvaWNlcwogICAgICAgICAgICAgIHZhbGlkID0gUmFuZ2UubmV3KDEsIGJyaWRnZWRp
ZnMubGVuZ3RoKQoKICAgICAgICAgICAgICAjIFRoZSBjaG9pY2UgdGhhdCB0aGUgdXNlciBoYXMg
Y2hvc2VuIGFzIHRoZSBicmlkZ2luZyBpbnRlcmZhY2UKICAgICAgICAgICAgICBjaG9pY2UgPSBu
aWwKICAgICAgICAgICAgICB3aGlsZSAhdmFsaWQuaW5jbHVkZT8oY2hvaWNlKQogICAgICAgICAg
ICAgICAgY2hvaWNlID0gQGVudls6dWldLmFzaygiV2hhdCBpbnRlcmZhY2Ugc2hvdWxkIHRoZSBu
ZXR3b3JrIGJyaWRnZSB0bz8gIikKICAgICAgICAgICAgICAgIGNob2ljZSA9IGNob2ljZS50b19p
CiAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgIGNob3Nlbl9icmlkZ2UgPSBicmlkZ2Vk
aWZzW2Nob2ljZSAtIDFdWzpuYW1lXQogICAgICAgICAgICBlbmQKICAgICAgICAgIGVuZAoKICAg
ICAgICAgIEBsb2dnZXIuaW5mbygiQnJpZGdpbmcgYWRhcHRlciAje2NvbmZpZ1s6YWRhcHRlcl19
IHRvICN7Y2hvc2VuX2JyaWRnZX0iKQoKICAgICAgICAgICMgR2l2ZW4gdGhlIGNob2ljZSB3ZSBj
YW4gbm93IGRlZmluZSB0aGUgYWRhcHRlciB3ZSdyZSB1c2luZwogICAgICAgICAgcmV0dXJuIHsK
ICAgICAgICAgICAgOmFkYXB0ZXIgICAgID0+IGNvbmZpZ1s6YWRhcHRlcl0sCiAgICAgICAgICAg
IDp0eXBlICAgICAgICA9PiA6YnJpZGdlZCwKICAgICAgICAgICAgOmJyaWRnZSAgICAgID0+IGNo
b3Nlbl9icmlkZ2UsCiAgICAgICAgICAgIDptYWNfYWRkcmVzcyA9PiBjb25maWdbOm1hY10sCiAg
ICAgICAgICAgIDpuaWNfdHlwZSAgICA9PiBjb25maWdbOm5pY190eXBlXQogICAgICAgICAgfQog
ICAgICAgIGVuZAoKICAgICAgICBkZWYgYnJpZGdlZF9uZXR3b3JrX2NvbmZpZyhjb25maWcpCiAg
ICAgICAgICBpZiBjb25maWdbOmlwXQogICAgICAgICAgICBvcHRpb25zID0gewogICAgICAgICAg
ICAgICAgOmF1dG9fY29uZmlnID0+IHRydWUsCiAgICAgICAgICAgICAgICA6bWFjICAgICAgICAg
PT4gbmlsLAogICAgICAgICAgICAgICAgOm5ldG1hc2sgICAgID0+ICIyNTUuMjU1LjI1NS4wIiwK
ICAgICAgICAgICAgICAgIDp0eXBlICAgICAgICA9PiA6c3RhdGljCiAgICAgICAgICAgIH0ubWVy
Z2UoY29uZmlnKQogICAgICAgICAgICBvcHRpb25zWzp0eXBlXSA9IG9wdGlvbnNbOnR5cGVdLnRv
X3N5bQogICAgICAgICAgICByZXR1cm4gb3B0aW9ucwogICAgICAgICAgZW5kCgogICAgICAgICAg
cmV0dXJuIHsKICAgICAgICAgICAgOnR5cGUgPT4gOmRoY3AsCiAgICAgICAgICAgIDp1c2VfZGhj
cF9hc3NpZ25lZF9kZWZhdWx0X3JvdXRlID0+IGNvbmZpZ1s6dXNlX2RoY3BfYXNzaWduZWRfZGVm
YXVsdF9yb3V0ZV0KICAgICAgICAgIH0KICAgICAgICBlbmQKCiAgICAgICAgZGVmIGhvc3Rvbmx5
X2NvbmZpZyhvcHRpb25zKQogICAgICAgICAgb3B0aW9ucyA9IHsKICAgICAgICAgICAgOmF1dG9f
Y29uZmlnID0+IHRydWUsCiAgICAgICAgICAgIDptYWMgICAgICAgICA9PiBuaWwsCiAgICAgICAg
ICAgIDpuZXRtYXNrICAgICA9PiAiMjU1LjI1NS4yNTUuMCIsCiAgICAgICAgICAgIDp0eXBlICAg
ICAgICA9PiA6c3RhdGljCiAgICAgICAgICB9Lm1lcmdlKG9wdGlvbnMpCgogICAgICAgICAgIyBN
YWtlIHN1cmUgdGhlIHR5cGUgaXMgYSBzeW1ib2wKICAgICAgICAgIG9wdGlvbnNbOnR5cGVdID0g
b3B0aW9uc1s6dHlwZV0udG9fc3ltCgogICAgICAgICAgIyBEZWZhdWx0IElQIGlzIGluIHRoZSAy
MC1iaXQgcHJpdmF0ZSBuZXR3b3JrIGJsb2NrIGZvciBESENQIGJhc2VkIG5ldHdvcmtzCiAgICAg
ICAgICBvcHRpb25zWzppcF0gPSAiMTcyLjI4LjEyOC4xIiBpZiBvcHRpb25zWzp0eXBlXSA9PSA6
ZGhjcAoKICAgICAgICAgICMgQ2FsY3VsYXRlIG91ciBuZXR3b3JrIGFkZHJlc3MgZm9yIHRoZSBn
aXZlbiBJUC9uZXRtYXNrCiAgICAgICAgICBuZXRhZGRyICA9IG5ldHdvcmtfYWRkcmVzcyhvcHRp
b25zWzppcF0sIG9wdGlvbnNbOm5ldG1hc2tdKQoKICAgICAgICAgICMgVmVyaWZ5IHRoYXQgYSBo
b3N0LW9ubHkgbmV0d29yayBzdWJuZXQgd291bGQgbm90IGNvbGxpZGUKICAgICAgICAgICMgd2l0
aCBhIGJyaWRnZWQgbmV0d29ya2luZyBpbnRlcmZhY2UuCiAgICAgICAgICAjCiAgICAgICAgICAj
IElmIHRoZSBzdWJuZXRzIG92ZXJsYXAgaW4gYW55IHdheSB0aGVuIHRoZSBob3N0IG9ubHkgbmV0
d29yawogICAgICAgICAgIyB3aWxsIG5vdCB3b3JrIGJlY2F1c2UgdGhlIHJvdXRpbmcgdGFibGVz
IHdpbGwgZm9yY2UgdGhlCiAgICAgICAgICAjIHRyYWZmaWMgb250byB0aGUgcmVhbCBpbnRlcmZh
Y2UgcmF0aGVyIHRoYW4gdGhlIFZpcnR1YWxCb3gKICAgICAgICAgICMgaW50ZXJmYWNlLgogICAg
ICAgICAgQGVudls6bWFjaGluZV0ucHJvdmlkZXIuZHJpdmVyLnJlYWRfYnJpZGdlZF9pbnRlcmZh
Y2VzLmVhY2ggZG8gfGludGVyZmFjZXwKICAgICAgICAgICAgdGhhdF9uZXRhZGRyID0gbmV0d29y
a19hZGRyZXNzKGludGVyZmFjZVs6aXBdLCBpbnRlcmZhY2VbOm5ldG1hc2tdKQogICAgICAgICAg
ICByYWlzZSBWYWdyYW50OjpFcnJvcnM6Ok5ldHdvcmtDb2xsaXNpb24gaWYgXAogICAgICAgICAg
ICAgIG5ldGFkZHIgPT0gdGhhdF9uZXRhZGRyICYmIGludGVyZmFjZVs6c3RhdHVzXSAhPSAiRG93
biIKICAgICAgICAgIGVuZAoKICAgICAgICAgICMgU3BsaXQgdGhlIElQIGFkZHJlc3MgaW50byBp
dHMgY29tcG9uZW50cwogICAgICAgICAgaXBfcGFydHMgPSBuZXRhZGRyLnNwbGl0KCIuIikubWFw
IHsgfGl8IGkudG9faSB9CgogICAgICAgICAgIyBDYWxjdWxhdGUgdGhlIGFkYXB0ZXIgSVAsIHdo
aWNoIHdlIGFzc3VtZSBpcyB0aGUgSVAgIi4xIiBhdAogICAgICAgICAgIyB0aGUgZW5kIHVzdWFs
bHkuCiAgICAgICAgICBhZGFwdGVyX2lwICAgID0gaXBfcGFydHMuZHVwCiAgICAgICAgICBhZGFw
dGVyX2lwWzNdICs9IDEKICAgICAgICAgIG9wdGlvbnNbOmFkYXB0ZXJfaXBdIHx8PSBhZGFwdGVy
X2lwLmpvaW4oIi4iKQoKICAgICAgICAgIGRoY3Bfb3B0aW9ucyA9IHt9CiAgICAgICAgICBpZiBv
cHRpb25zWzp0eXBlXSA9PSA6ZGhjcAogICAgICAgICAgICAjIENhbGN1bGF0ZSB0aGUgREhDUCBz
ZXJ2ZXIgSVAsIHdoaWNoIGlzIHRoZSBuZXR3b3JrIGFkZHJlc3MKICAgICAgICAgICAgIyB3aXRo
IHRoZSBmaW5hbCBvY3RldCArIDIuIFNvICIxNzIuMjguMC4wIiB0dXJucyBpbnRvICIxNzIuMjgu
MC4yIgogICAgICAgICAgICBkaGNwX2lwICAgID0gaXBfcGFydHMuZHVwCiAgICAgICAgICAgIGRo
Y3BfaXBbM10gKz0gMgogICAgICAgICAgICBkaGNwX29wdGlvbnNbOmRoY3BfaXBdIHx8PSBkaGNw
X2lwLmpvaW4oIi4iKQoKICAgICAgICAgICAgIyBDYWxjdWxhdGUgdGhlIGxvd2VyIGFuZCB1cHBl
ciBib3VuZCBmb3IgdGhlIERIQ1Agc2VydmVyCiAgICAgICAgICAgIGRoY3BfbG93ZXIgICAgPSBp
cF9wYXJ0cy5kdXAKICAgICAgICAgICAgZGhjcF9sb3dlclszXSArPSAzCiAgICAgICAgICAgIGRo
Y3Bfb3B0aW9uc1s6ZGhjcF9sb3dlcl0gfHw9IGRoY3BfbG93ZXIuam9pbigiLiIpCgogICAgICAg
ICAgICBkaGNwX3VwcGVyICAgID0gaXBfcGFydHMuZHVwCiAgICAgICAgICAgIGRoY3BfdXBwZXJb
M10gPSAyNTQKICAgICAgICAgICAgZGhjcF9vcHRpb25zWzpkaGNwX3VwcGVyXSB8fD0gZGhjcF91
cHBlci5qb2luKCIuIikKICAgICAgICAgIGVuZAoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAg
ICAgIDphZGFwdGVyX2lwICA9PiBvcHRpb25zWzphZGFwdGVyX2lwXSwKICAgICAgICAgICAgOmF1
dG9fY29uZmlnID0+IG9wdGlvbnNbOmF1dG9fY29uZmlnXSwKICAgICAgICAgICAgOmlwICAgICAg
ICAgID0+IG9wdGlvbnNbOmlwXSwKICAgICAgICAgICAgOm1hYyAgICAgICAgID0+IG9wdGlvbnNb
Om1hY10sCiAgICAgICAgICAgIDpuZXRtYXNrICAgICA9PiBvcHRpb25zWzpuZXRtYXNrXSwKICAg
ICAgICAgICAgOm5pY190eXBlICAgID0+IG5pbCwKICAgICAgICAgICAgOnR5cGUgICAgICAgID0+
IG9wdGlvbnNbOnR5cGVdCiAgICAgICAgICB9Lm1lcmdlKGRoY3Bfb3B0aW9ucykKICAgICAgICBl
bmQKCiAgICAgICAgZGVmIGhvc3Rvbmx5X2FkYXB0ZXIoY29uZmlnKQogICAgICAgICAgQGxvZ2dl
ci5pbmZvKCJTZWFyY2hpbmcgZm9yIG1hdGNoaW5nIGhvc3Rvbmx5IG5ldHdvcms6ICN7Y29uZmln
WzppcF19IikKICAgICAgICAgIGludGVyZmFjZSA9IGhvc3Rvbmx5X2ZpbmRfbWF0Y2hpbmdfbmV0
d29yayhjb25maWcpCgogICAgICAgICAgaWYgIWludGVyZmFjZQogICAgICAgICAgICBAbG9nZ2Vy
LmluZm8oIk5ldHdvcmsgbm90IGZvdW5kLiBDcmVhdGluZyBpZiB3ZSBjYW4uIikKCiAgICAgICAg
ICAgICMgSXQgaXMgYW4gZXJyb3IgaWYgYSBzcGVjaWZpYyBob3N0IG9ubHkgbmV0d29yayBuYW1l
IHdhcyBzcGVjaWZpZWQKICAgICAgICAgICAgIyBidXQgdGhlIG5ldHdvcmsgd2Fzbid0IGZvdW5k
LgogICAgICAgICAgICBpZiBjb25maWdbOm5hbWVdCiAgICAgICAgICAgICAgcmFpc2UgVmFncmFu
dDo6RXJyb3JzOjpOZXR3b3JrTm90Rm91bmQsIDpuYW1lID0+IGNvbmZpZ1s6bmFtZV0KICAgICAg
ICAgICAgZW5kCgogICAgICAgICAgICAjIENyZWF0ZSBhIG5ldyBuZXR3b3JrCiAgICAgICAgICAg
IGludGVyZmFjZSA9IGhvc3Rvbmx5X2NyZWF0ZV9uZXR3b3JrKGNvbmZpZykKICAgICAgICAgICAg
QGxvZ2dlci5pbmZvKCJDcmVhdGVkIG5ldHdvcms6ICN7aW50ZXJmYWNlWzpuYW1lXX0iKQogICAg
ICAgICAgZW5kCgogICAgICAgICAgaWYgY29uZmlnWzp0eXBlXSA9PSA6ZGhjcAogICAgICAgICAg
ICAjIENoZWNrIHRoYXQgaWYgdGhlcmUgaXMgYSBESENQIHNlcnZlciBhdHRhY2hlZCBvbiBvdXIg
aW50ZXJmYWNlLAogICAgICAgICAgICAjIHRoZW4gaXQgaXMgaWRlbnRpY2FsLiBPdGhlcndpc2Us
IHdlIGNhbid0IHNldCBpdC4KICAgICAgICAgICAgaWYgaW50ZXJmYWNlWzpkaGNwXQogICAgICAg
ICAgICAgIHZhbGlkID0gaW50ZXJmYWNlWzpkaGNwXVs6aXBdID09IGNvbmZpZ1s6ZGhjcF9pcF0g
JiYKICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlWzpkaGNwXVs6bG93ZXJdID09IGNvbmZpZ1s6
ZGhjcF9sb3dlcl0gJiYKICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlWzpkaGNwXVs6dXBwZXJd
ID09IGNvbmZpZ1s6ZGhjcF91cHBlcl0KCiAgICAgICAgICAgICAgcmFpc2UgRXJyb3JzOjpOZXR3
b3JrREhDUEFscmVhZHlBdHRhY2hlZCBpZiAhdmFsaWQKCiAgICAgICAgICAgICAgQGxvZ2dlci5k
ZWJ1ZygiREhDUCBzZXJ2ZXIgYWxyZWFkeSBwcm9wZXJseSBjb25maWd1cmVkIikKICAgICAgICAg
ICAgZWxzZQogICAgICAgICAgICAgICMgQ29uZmlndXJlIHRoZSBESENQIHNlcnZlciBmb3IgdGhl
IG5ldHdvcmsuCiAgICAgICAgICAgICAgQGxvZ2dlci5kZWJ1ZygiQ3JlYXRpbmcgYSBESENQIHNl
cnZlci4uLiIpCiAgICAgICAgICAgICAgQGVudls6bWFjaGluZV0ucHJvdmlkZXIuZHJpdmVyLmNy
ZWF0ZV9kaGNwX3NlcnZlcihpbnRlcmZhY2VbOm5hbWVdLCBjb25maWcpCiAgICAgICAgICAgIGVu
ZAogICAgICAgICAgZW5kCgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgOmFkYXB0ZXIg
ID0+IGNvbmZpZ1s6YWRhcHRlcl0sCiAgICAgICAgICAgIDpob3N0b25seSA9PiBpbnRlcmZhY2Vb
Om5hbWVdLAogICAgICAgICAgICA6bWFjICAgICAgPT4gY29uZmlnWzptYWNdLAogICAgICAgICAg
ICA6bmljX3R5cGUgPT4gY29uZmlnWzpuaWNfdHlwZV0sCiAgICAgICAgICAgIDp0eXBlICAgICA9
PiA6aG9zdG9ubHkKICAgICAgICAgIH0KICAgICAgICBlbmQKCiAgICAgICAgZGVmIGhvc3Rvbmx5
X25ldHdvcmtfY29uZmlnKGNvbmZpZykKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIDp0
eXBlICAgICAgID0+IGNvbmZpZ1s6dHlwZV0sCiAgICAgICAgICAgIDphZGFwdGVyX2lwID0+IGNv
bmZpZ1s6YWRhcHRlcl9pcF0sCiAgICAgICAgICAgIDppcCAgICAgICAgID0+IGNvbmZpZ1s6aXBd
LAogICAgICAgICAgICA6bmV0bWFzayAgICA9PiBjb25maWdbOm5ldG1hc2tdCiAgICAgICAgICB9
CiAgICAgICAgZW5kCgogICAgICAgIGRlZiBuYXRfY29uZmlnKG9wdGlvbnMpCiAgICAgICAgICBy
ZXR1cm4gewogICAgICAgICAgICA6YXV0b19jb25maWcgPT4gZmFsc2UKICAgICAgICAgIH0KICAg
ICAgICBlbmQKCiAgICAgICAgZGVmIG5hdF9hZGFwdGVyKGNvbmZpZykKICAgICAgICAgIHJldHVy
biB7CiAgICAgICAgICAgIDphZGFwdGVyID0+IGNvbmZpZ1s6YWRhcHRlcl0sCiAgICAgICAgICAg
IDp0eXBlICAgID0+IDpuYXQsCiAgICAgICAgICB9CiAgICAgICAgZW5kCgogICAgICAgIGRlZiBu
YXRfbmV0d29ya19jb25maWcoY29uZmlnKQogICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgZW5k
CgogICAgICAgICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICMgTWlzYy4gaGVscGVycwogICAgICAgICMtLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQogICAgICAgICMgQXNzaWducyB0aGUgYWN0dWFsIGludGVyZmFjZSBudW1iZXIgb2YgYSBu
ZXR3b3JrIGJhc2VkIG9uIHRoZQogICAgICAgICMgZW5hYmxlZCBOSUNzIG9uIHRoZSB2aXJ0dWFs
IG1hY2hpbmUuCiAgICAgICAgIwogICAgICAgICMgVGhpcyBpbnRlcmZhY2UgbnVtYmVyIGlzIHVz
ZWQgYnkgdGhlIGd1ZXN0IHRvIGNvbmZpZ3VyZSB0aGUKICAgICAgICAjIE5JQyBvbiB0aGUgZ3Vl
c3QgVk0uCiAgICAgICAgIwogICAgICAgICMgVGhlIG5ldHdvcmtzIGFyZSBtb2RpZmllZCBpbiBw
bGFjZSBieSBhZGRpbmcgYW4gIjppbnRlcmZhY2UiCiAgICAgICAgIyBmaWVsZCB0byBlYWNoLgog
ICAgICAgIGRlZiBhc3NpZ25faW50ZXJmYWNlX251bWJlcnMobmV0d29ya3MsIGFkYXB0ZXJzKQog
ICAgICAgICAgY3VycmVudCA9IDAKICAgICAgICAgIGFkYXB0ZXJfdG9faW50ZXJmYWNlID0ge30K
CiAgICAgICAgICAjIE1ha2UgYSBmaXJzdCBwYXNzIHRvIGFzc2lnbiBpbnRlcmZhY2UgbnVtYmVy
cyBieSBhZGFwdGVyIGxvY2F0aW9uCiAgICAgICAgICB2bV9hZGFwdGVycyA9IEBlbnZbOm1hY2hp
bmVdLnByb3ZpZGVyLmRyaXZlci5yZWFkX25ldHdvcmtfaW50ZXJmYWNlcwogICAgICAgICAgdm1f
YWRhcHRlcnMuc29ydC5lYWNoIGRvIHxudW1iZXIsIGFkYXB0ZXJ8CiAgICAgICAgICAgIGlmIGFk
YXB0ZXJbOnR5cGVdICE9IDpub25lCiAgICAgICAgICAgICAgIyBOb3QgdXNlZCwgc28gYXNzaWdu
IHRoZSBpbnRlcmZhY2UgbnVtYmVyIGFuZCBpbmNyZW1lbnQKICAgICAgICAgICAgICBhZGFwdGVy
X3RvX2ludGVyZmFjZVtudW1iZXJdID0gY3VycmVudAogICAgICAgICAgICAgIGN1cnJlbnQgKz0g
MQogICAgICAgICAgICBlbmQKICAgICAgICAgIGVuZAoKICAgICAgICAgICMgTWFrZSBhIHBhc3Mg
dGhyb3VnaCB0aGUgYWRhcHRlcnMgdG8gYXNzaWduIHRoZSA6aW50ZXJmYWNlCiAgICAgICAgICAj
IGtleSB0byBlYWNoIG5ldHdvcmsgY29uZmlndXJhdGlvbi4KICAgICAgICAgIGFkYXB0ZXJzLmVh
Y2hfaW5kZXggZG8gfGl8CiAgICAgICAgICAgIGFkYXB0ZXIgPSBhZGFwdGVyc1tpXQogICAgICAg
ICAgICBuZXR3b3JrID0gbmV0d29ya3NbaV0KCiAgICAgICAgICAgICMgRmlndXJlIG91dCB0aGUg
aW50ZXJmYWNlIG51bWJlciBieSBzaW1wbGUgbG9va3VwCiAgICAgICAgICAgIG5ldHdvcmtbOmlu
dGVyZmFjZV0gPSBhZGFwdGVyX3RvX2ludGVyZmFjZVthZGFwdGVyWzphZGFwdGVyXV0KICAgICAg
ICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAjIEhvc3Rvbmx5
IEhlbHBlciBGdW5jdGlvbnMKICAgICAgICAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAjIFRoaXMgY3JlYXRl
cyBhIGhvc3Qgb25seSBuZXR3b3JrIGZvciB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbi4KICAgICAg
ICBkZWYgaG9zdG9ubHlfY3JlYXRlX25ldHdvcmsoY29uZmlnKQogICAgICAgICAgQGVudls6bWFj
aGluZV0ucHJvdmlkZXIuZHJpdmVyLmNyZWF0ZV9ob3N0X29ubHlfbmV0d29yaygKICAgICAgICAg
ICAgOmFkYXB0ZXJfaXAgPT4gY29uZmlnWzphZGFwdGVyX2lwXSwKICAgICAgICAgICAgOm5ldG1h
c2sgICAgPT4gY29uZmlnWzpuZXRtYXNrXQogICAgICAgICAgKQogICAgICAgIGVuZAoKICAgICAg
ICAjIFRoaXMgZmluZHMgYSBtYXRjaGluZyBob3N0IG9ubHkgbmV0d29yayBmb3IgdGhlIGdpdmVu
IGNvbmZpZ3VyYXRpb24uCiAgICAgICAgZGVmIGhvc3Rvbmx5X2ZpbmRfbWF0Y2hpbmdfbmV0d29y
ayhjb25maWcpCiAgICAgICAgICB0aGlzX25ldGFkZHIgPSBuZXR3b3JrX2FkZHJlc3MoY29uZmln
WzppcF0sIGNvbmZpZ1s6bmV0bWFza10pCgogICAgICAgICAgQGVudls6bWFjaGluZV0ucHJvdmlk
ZXIuZHJpdmVyLnJlYWRfaG9zdF9vbmx5X2ludGVyZmFjZXMuZWFjaCBkbyB8aW50ZXJmYWNlfAog
ICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlIGlmIGNvbmZpZ1s6bmFtZV0gJiYgY29uZmlnWzpu
YW1lXSA9PSBpbnRlcmZhY2VbOm5hbWVdCiAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2UgaWYg
dGhpc19uZXRhZGRyID09IFwKICAgICAgICAgICAgICBuZXR3b3JrX2FkZHJlc3MoaW50ZXJmYWNl
WzppcF0sIGludGVyZmFjZVs6bmV0bWFza10pCiAgICAgICAgICBlbmQKCiAgICAgICAgICBuaWwK
ICAgICAgICBlbmQKICAgICAgZW5kCiAgICBlbmQKICBlbmQKZW5kCgo=
__END_PATCH";
rc=$?
if [[ $rc != 0 ]] ; then
    #rollback
    echo "rolling back";
    sudo mv $VAGRANT_FILE_PATH.old $VAGRANT_FILE_PATH;
fi
echo "done";
else echo -e "network.rb not found.\nDo you have Vagrant version 1.2.2 ?\nDo you have the network.rb file in $VAGRANT_FILE_PATH ?"
fi

